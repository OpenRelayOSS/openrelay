# Entry Payload Format
* 4byte alignment 

## Get Merged Distributed Map
/room/distmap/:room_name

```


  0               8                16               24               32
  +---------------- ---------------- ---------------- ----------------+
  |      Response Code (uint16)     |      Content Length (uint16)    |
  +---------------- ---------------- ---------------- ----------------+
  |      Elements Count (uint16)    |            Alignment            |
  +---------------- ---------------- ---------------- ----------------+
  |                      Merged revision (uint32)                     |
  +---------------- ---------------- ---------------- ----------------+
  |                      Latest revision (uint32)                     |
  +---------------- ---------------- ---------------- ----------------+
  |   Key Length   |   Key Length   |   Key Length   |   Key Length   |
  +---------------- ---------------- ---------------- ----------------+
  |   Key Length   |   Key Length   |   Key Length   |   Key Length   |
  +---------------- ----------------//--------------- ----------------+
                     ... Elements counts assigned
  +---------------- ----------------//--------------- ----------------+
  |   Key Length   |   Key Length   |            Alignment            |
  +---------------- ---------------- ---------------- ----------------+
  |      Value Length (uint16)      |      Value Length (uint16)      |
  +---------------- ---------------- ---------------- ----------------+
  |      Value Length (uint16)      |      Value Length (uint16)      |
  +---------------- ----------------//--------------- ----------------+
                     ... Elements counts assigned
  +---------------- ----------------//--------------- ----------------+
  |      Value Length (uint16)      |            Alignment            |
  +---------------- ---------------- ---------------- ----------------+
  |                  Key Bytes (free size byte array)                 |
  +---------------- ---------------- ---------------- ----------------+
  |                                                                   |
  +---------------- ---------------- ---------------- ----------------+
  |         |                                 Alignment               |
  +---------------- ---------------- ---------------- ----------------+
  |                  Key Bytes (free size byte array)                 |
  +---------------- ---------------- ---------------- ----------------+
  |                                                                   |
  +---------------- ---------------- ---------------- ----------------+
  |                                       |   Alignment               |
  +---------------- ----------------//--------------- ----------------+
                     ... Elements counts assigned
  +---------------- ----------------//--------------- ----------------+
  |                  Key Bytes (free size byte array)                 |
  +---------------- ---------------- ---------------- ----------------+
  |                                                                   |
  +---------------- ---------------- ---------------- ----------------+
  |                           |               Alignment               |
  +---------------- ---------------- ---------------- ----------------+
  |                 Value Bytes (free size byte array)                |
  +---------------- ---------------- ---------------- ----------------+
  |                                                                   |
  +---------------- ---------------- ---------------- ----------------+
  |                                                                   |
  +---------------- ---------------- ---------------- ----------------+
  |                                                                   |
  +---------------- ---------------- ---------------- ----------------+
  |    |                                      Alignment               |
  +---------------- ---------------- ---------------- ----------------+
  |                 Value Bytes (free size byte array)                |
  +---------------- ---------------- ---------------- ----------------+
  |                                                                   |
  +---------------- ---------------- ---------------- ----------------+
  |                                                                   |
  +---------------- ---------------- ---------------- ----------------+
  |                    |                      Alignment               |
  +---------------- ----------------//--------------- ----------------+
                     ... Elements counts assigned
  +---------------- ----------------//--------------- ----------------+
  |                 Value Bytes (free size byte array)                |
  +---------------- ---------------- ---------------- ----------------+
  |                                                                   |
  +---------------- ---------------- ---------------- ----------------+
  |                                                                   |
  +---------------- ---------------- ---------------- ----------------+
  |                                       |   Alignment               |
  +---------------- ---------------- ---------------- ----------------+
  ```
  

# Relay Payload Format
* 4byte alignment
* Recommend payload size are less than 800 bytes.

## Header
16bytes fixed  
defs.Header
```
  0               8                16               24               32
  +---------------- ---------------- ---------------- ----------------+
  |    Version     |    RelayCode   |  ContentCode   |    DestCode    |
  +---------------- ---------------- ---------------- ----------------+
  |    Mask        |             SrcUid              |    Alignment   |
  +---------------- ---------------- ---------------- ----------------+
  |           SrcOid(uint16)        |          DestLen(uint16)        |
  +---------------- ---------------- ---------------- ----------------+
  |         ContentLen(uint16)      |            Alignment            |
  +---------------- ---------------- ---------------- ----------------+
```

## Update Distributed Map
12bytes over  
defs.UPDATE_DIST_MAP
```
  0               8                16               24               32
  +---------------- ---------------- ---------------- ----------------+
  |                       Latest Revision (uint32)                    |
  +---------------- ---------------- ---------------- ----------------+
  |                         Timestamp (int32)                         |
  +---------------- ---------------- ---------------- ----------------+
  |   Mode(int8)   |   Key Length   |      Value Length (uint16)      |
  +---------------- ---------------- ---------------- ----------------+
  |                  Key Bytes (free size byte array)                 |
  +---------------- ---------------- ---------------- ----------------+
  |                                                                   |
  +---------------- ---------------- ---------------- ----------------+
  |                           |               Alignment               |
  +---------------- ---------------- ---------------- ----------------+
  |                 Value Bytes (free size byte array)                |
  +---------------- ---------------- ---------------- ----------------+
  |                                                                   |
  +---------------- ---------------- ---------------- ----------------+
  |                                                                   |
  +---------------- ---------------- ---------------- ----------------+
  |                                                                   |
  +---------------- ---------------- ---------------- ----------------+
  |                    |
  +-------- -------- --+
```
Mode  
-1 ... Remove  
0  ... Add or Set  
  
## Pick Distributed Map (Request)
4byte fixed  
defs.PICK_DIST_MAP
```
  0               8                16               24               32
  +---------------- ---------------- ---------------- ----------------+
  |                        Pick Revision (uint32)                     |
  +---------------- ---------------- ---------------- ----------------+
```
  
## Pick Distributed Map (Relay)
12bytes over  
defs.PICK_DIST_MAP
```
  0               8                16               24               32
  +---------------- ---------------- ---------------- ----------------+
  |                        Pick Revision (uint32)                     |
  +---------------- ---------------- ---------------- ----------------+
  |                       Latest Revision (uint32)                    |
  +---------------- ---------------- ---------------- ----------------+
  |                         Timestamp (int32)                         |
  +---------------- ---------------- ---------------- ----------------+
  |  Mode(sbyte)   |   Key Length   |      Value Length (uint16)      |
  +---------------- ---------------- ---------------- ----------------+
  |                  Key Bytes (free size byte array)                 |
  +---------------- ---------------- ---------------- ----------------+
  |                                                                   |
  +---------------- ---------------- ---------------- ----------------+
  |                           |               Alignment               |
  +---------------- ---------------- ---------------- ----------------+
  |                 Value Bytes (free size byte array)                |
  +---------------- ---------------- ---------------- ----------------+
  |                                                                   |
  +---------------- ---------------- ---------------- ----------------+
  |                                                                   |
  +---------------- ---------------- ---------------- ----------------+
  |                                                                   |
  +---------------- ---------------- ---------------- ----------------+
  |                    |
  +-------- -------- --+
```
Mode  
-1 ... Remove  
0  ... Add or Set  

## Notify User's Distributed Map Latest Revision
4byte fixed  
defs.NOTIFY_DIST_MAP_LATEST
```
  0               8                16               24               32
  +---------------- ---------------- ---------------- ----------------+
  |                  User's Merged Revision (uint32)                  |
  +---------------- ---------------- ---------------- ----------------+
```
